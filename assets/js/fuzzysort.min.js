!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof module&&module.exports?module.exports=r():e.fuzzysort=r()}(this,function(){function e(c){var g={single:function(e,r,n){if(!e)return null;if(t(e)||(e=g.getPreparedSearch(e)),!r)return null;t(r)||(r=g.getPrepared(r));return((n&&void 0!==n.allowTypo?n.allowTypo:!c||void 0===c.allowTypo||c.allowTypo)?g.algorithm:g.algorithmNoTypo)(e,r,e[0])},go:function(e,r,i){if(!e)return f;var a=(e=g.prepareSearch(e))[0],l=i&&i.threshold||c&&c.threshold||-9007199254740991,u=i&&i.limit||c&&c.limit||9007199254740991,s=(i&&void 0!==i.allowTypo?i.allowTypo:!c||void 0===c.allowTypo||c.allowTypo)?g.algorithm:g.algorithmNoTypo,p=0,v=0,h=r.length;if(i&&i.keys)for(var w=i.scoreFn||n,x=i.keys,y=x.length,m=h-1;m>=0;--m){for(var T=r[m],k=new Array(y),b=y-1;b>=0;--b){(C=o(T,_=x[b]))?(t(C)||(C=g.getPrepared(C)),k[b]=s(e,C,a)):k[b]=null}k.obj=T;var I=w(k);null!==I&&(I<l||(k.score=I,p<u?(d.add(k),++p):(++v,I>d.peek().score&&d.replaceTop(k))))}else if(i&&i.key)for(var _=i.key,m=h-1;m>=0;--m){var B=m;if(C=o(T=r[m],_)){t(C)||(C=g.getPrepared(C));null!==(A=s(e,C,a))&&(A.score<l||(A={obj_index:B,target:A.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:A.score,indexes:A.indexes,obj:T},p<u?(d.add(A),++p):(++v,A.score>d.peek().score&&d.replaceTop(A))))}}else for(m=h-1;m>=0;--m){var C=r[m];if(C){t(C)||(C=g.getPrepared(C));var A=s(e,C,a);null!==A&&(A.score<l||(p<u?(d.add(A),++p):(++v,A.score>d.peek().score&&d.replaceTop(A))))}}if(0===p)return f;for(var L=new Array(p),m=p-1;m>=0;--m)L[m]=d.poll();return L.total=p+v,L},goAsync:function(e,r,a){var l=!1,u=new Promise(function(u,s){function d(){if(l)return s("canceled");var p=Date.now();if(a&&a.keys)for(var c=a.scoreFn||n,b=a.keys,I=b.length;w>=0;--w){for(var _=r[w],B=new Array(I),C=I-1;C>=0;--C){(P=o(_,L=b[C]))?(t(P)||(P=g.getPrepared(P)),B[C]=m(e,P,v)):B[C]=null}B.obj=_;var A=c(B);if(null!==A&&(!(A<x)&&(B.score=A,T<y?(h.add(B),++T):(++k,A>h.peek().score&&h.replaceTop(B)),w%1e3==0&&Date.now()-p>=10)))return void(i?setImmediate(d):setTimeout(d))}else if(a&&a.key)for(var L=a.key;w>=0;--w){if(P=o(_=r[w],L)){t(P)||(P=g.getPrepared(P));if(null!==(j=m(e,P,v))&&!(j.score<x)&&(j={target:j.target,_targetLowerCodes:null,_nextBeginningIndexes:null,score:j.score,indexes:j.indexes,obj:_},T<y?(h.add(j),++T):(++k,j.score>h.peek().score&&h.replaceTop(j)),w%1e3==0&&Date.now()-p>=10))return void(i?setImmediate(d):setTimeout(d))}}else for(;w>=0;--w){var P=r[w];if(P){t(P)||(P=g.getPrepared(P));var j=m(e,P,v);if(null!==j&&!(j.score<x)&&(T<y?(h.add(j),++T):(++k,j.score>h.peek().score&&h.replaceTop(j)),w%1e3==0&&Date.now()-p>=10))return void(i?setImmediate(d):setTimeout(d))}}if(0===T)return u(f);for(var N=new Array(T),S=T-1;S>=0;--S)N[S]=h.poll();N.total=T+k,u(N)}if(!e)return u(f);var v=(e=g.prepareSearch(e))[0],h=p(),w=r.length-1,x=a&&a.threshold||c&&c.threshold||-9007199254740991,y=a&&a.limit||c&&c.limit||9007199254740991,m=(a&&void 0!==a.allowTypo?a.allowTypo:!c||void 0===c.allowTypo||c.allowTypo)?g.algorithm:g.algorithmNoTypo,T=0,k=0;i?setImmediate(d):d()});return u.cancel=function(){l=!0},u},highlight:function(e,r,n){if(null===e)return null;void 0===r&&(r="<b>"),void 0===n&&(n="</b>");for(var o="",t=0,i=!1,a=e.target,l=a.length,f=e.indexes,u=0;u<l;++u){var s=a[u];if(f[t]===u){if(++t,i||(i=!0,o+=r),t===f.length){o+=s+n+a.substr(u+1);break}}else i&&(i=!1,o+=n);o+=s}return o},prepare:function(e){if(e)return{target:e,_targetLowerCodes:g.prepareLowerCodes(e),_nextBeginningIndexes:null,score:null,indexes:null,obj:null}},prepareSlow:function(e){if(e)return{target:e,_targetLowerCodes:g.prepareLowerCodes(e),_nextBeginningIndexes:g.prepareNextBeginningIndexes(e),score:null,indexes:null,obj:null}},prepareSearch:function(e){if(e)return g.prepareLowerCodes(e)},getPrepared:function(e){if(e.length>999)return g.prepare(e);var r=a.get(e);return void 0!==r?r:(r=g.prepare(e),a.set(e,r),r)},getPreparedSearch:function(e){if(e.length>999)return g.prepareSearch(e);var r=l.get(e);return void 0!==r?r:(r=g.prepareSearch(e),l.set(e,r),r)},algorithm:function(e,r,n){for(var o=r._targetLowerCodes,t=e.length,i=o.length,a=0,l=0,f=0,p=0;;){if(y=n===o[l]){if(u[p++]=l,++a===t)break;n=e[0===f?a:f===a?a+1:f===a-1?a-1:a]}if(++l>=i)for(;;){if(a<=1)return null;if(0===f){if(n===(d=e[--a]))continue;f=a}else{if(1===f)return null;n=e[(a=--f)+1];var d=e[a];if(n===d)continue}l=u[(p=a)-1]+1;break}}var a=0,c=0,v=!1,h=0,w=r._nextBeginningIndexes;null===w&&(w=r._nextBeginningIndexes=g.prepareNextBeginningIndexes(r.target));var x=l=0===u[0]?0:w[u[0]-1];if(l!==i)for(;;)if(l>=i){if(a<=0){if(++c>t-2)break;if(e[c]===e[c+1])continue;l=x;continue}--a;l=w[s[--h]]}else{var y=e[0===c?a:c===a?a+1:c===a-1?a-1:a]===o[l];if(y){if(s[h++]=l,++a===t){v=!0;break}++l}else l=w[l]}if(v)var m=s,T=h;else var m=u,T=p;for(var k=0,b=-1,I=0;I<t;++I){b!==(l=m[I])-1&&(k-=l),b=l}v?0!==c&&(k+=-20):(k*=1e3,0!==f&&(k+=-20)),k-=i-t,r.score=k,r.indexes=new Array(T);for(I=T-1;I>=0;--I)r.indexes[I]=m[I];return r},algorithmNoTypo:function(e,r,n){for(var o=r._targetLowerCodes,t=e.length,i=o.length,a=0,l=0,f=0;;){if(v=n===o[l]){if(u[f++]=l,++a===t)break;n=e[a]}if(++l>=i)return null}var a=0,p=!1,d=0,c=r._nextBeginningIndexes;null===c&&(c=r._nextBeginningIndexes=g.prepareNextBeginningIndexes(r.target));l=0===u[0]?0:c[u[0]-1];if(l!==i)for(;;)if(l>=i){if(a<=0)break;--a;l=c[s[--d]]}else{var v=e[a]===o[l];if(v){if(s[d++]=l,++a===t){p=!0;break}++l}else l=c[l]}if(p)var h=s,w=d;else var h=u,w=f;for(var x=0,y=-1,m=0;m<t;++m){y!==(l=h[m])-1&&(x-=l),y=l}p||(x*=1e3),x-=i-t,r.score=x,r.indexes=new Array(w);for(m=w-1;m>=0;--m)r.indexes[m]=h[m];return r},prepareLowerCodes:function(e){for(var r=e.length,n=[],o=e.toLowerCase(),t=0;t<r;++t)n[t]=o.charCodeAt(t);return n},prepareBeginningIndexes:function(e){for(var r=e.length,n=[],o=0,t=!1,i=!1,a=0;a<r;++a){var l=e.charCodeAt(a),f=l>=65&&l<=90,u=f||l>=97&&l<=122||l>=48&&l<=57,s=f&&!t||!i||!u;t=f,i=u,s&&(n[o++]=a)}return n},prepareNextBeginningIndexes:function(e){for(var r=e.length,n=g.prepareBeginningIndexes(e),o=[],t=n[0],i=0,a=0;a<r;++a)t>a?o[a]=t:(t=n[++i],o[a]=void 0===t?r:t);return o},cleanup:r,new:e};return g}function r(){a.clear(),l.clear(),u=[],s=[]}function n(e){for(var r=-9007199254740991,n=e.length-1;n>=0;--n){var o=e[n];if(null!==o){var t=o.score;t>r&&(r=t)}}return-9007199254740991===r?null:r}function o(e,r){var n=e[r];if(void 0!==n)return n;var o=r;Array.isArray(r)||(o=r.split("."));for(var t=o.length,i=-1;e&&++i<t;)e=e[o[i]];return e}function t(e){return"object"==typeof e}var i="undefined"!=typeof require&&"undefined"==typeof window,a=new Map,l=new Map,f=[];f.total=0;var u=[],s=[],p=function(){function e(){for(var e=0,o=r[e],t=1;t<n;){var i=t+1;e=t,i<n&&r[i].score<r[t].score&&(e=i),r[e-1>>1]=r[e],t=1+(e<<1)}for(var a=e-1>>1;e>0&&o.score<r[a].score;a=(e=a)-1>>1)r[e]=r[a];r[e]=o}var r=[],n=0,o={};return o.add=function(e){var o=n;r[n++]=e;for(var t=o-1>>1;o>0&&e.score<r[t].score;t=(o=t)-1>>1)r[o]=r[t];r[o]=e},o.poll=function(){if(0!==n){var o=r[0];return r[0]=r[--n],e(),o}},o.peek=function(e){if(0!==n)return r[0]},o.replaceTop=function(n){r[0]=n,e()},o},d=p();return e()});